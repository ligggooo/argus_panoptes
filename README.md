# jiliang_monitor

*集成组后台运维管理系统*

## v1.2.1 ---------------------------------
### 变更
1. 修复两个问题

     batch_id 可能会重复，放弃使用batchid作为根节点id，全部改为root_id
     记录在数据库中打乱，会导致构建树的时候出现顺序错乱，这样新的record就添加不进来； 
     此时将添加不进来的记录添加到 orphans列表里面；然后通过暴力重试的方法将orphan
     添加到树里面。

     为了避免树的割裂导致死循环，检查遍历一趟之后 orphan是否减少，若没有，则退出循环，
     并将根节点标记为记录丢失

2. 包依赖调整

     现在jiliang_process目录可以直接拷贝出来，独立放到任意项目里面使用

3. 调通跨celery调用（极少的代码修改），已经基本具备实用条件

4. 通过缓存查询任务记录，较大地优化了性能

### 遗留问题
1. 前端显示时存在bug，叶子节点的展开会同时显示siblings； 
2. 任务监控页面受限于数据库访问速度，有待优化；
3. 前端近期会有大改，需要及时开始前后端分离工作。

## v1.2.0 ---------------------------------
### 变更
1. 任务管理系统上线

## v1.1.1 ---------------------------------
### 变更
1. 修改数据库
    sqlite >>>>>>>>  postgres
    "sqlite:///my_db.sqlite" >>>>>>>>>> "postgresql://postgres:123456@10.130.160.114:60030/my_test"
2. 增加服务规范
    后台在部署服务和删除服务的时候会执行install_{包名}.sh 和 remove_{包名}.sh来安装和卸载服务
    每一个服务包中都必须包含有这两个文件。
3. 同一个容器中不允许存在同一个包的多个版本。
    后端对包名做匹配检查而不是对版本号做匹配项检查，后上传的软件包会覆盖线上传的软件包
4. 同一个容器中支持存在多个不同的软件包
    通过在服务部署页面添加文件上传功能实现
5. 添加一个CI_CD视图，用来响应gitlab的web hook请求。


## v1.1.0 ---------------------------------
### 尚未完成
1. docker管理
    创建时增加磁盘路径映射参数
    查看容器里面的目录结构
2. 机器管理
    机器管理页面的编辑和新增
3. 服务管理
    获取服务的日志

###已经完成
1. 端口映射管理  
    增加可用物理机端口表  
    容器增加端口映射字段  
    在机器管理页面显示已经占用的端口  
    在容器创建时检查  
    在容器页面显示  
2. 服务创建禁止出现重复记录  
    临时上传的用于调试的代码允许重复记录  
    select方式从版本库中创建的代码不允许出现重复记录  
    后上传的会把新上传的覆盖掉
3. 在线编辑docker启动脚本
    从容器里面拷贝文件出来
    修改文件
    拷贝文件进入docker容器


## v1.0.0 ---------------------------------
### 尚未完成的功能点：
1. 容器管理  
    在线编辑docker启动脚本
    从容器里面拷贝文件出来  
    查看容器里面的目录结构  
2. 机器管理  
    机器管理页面的编辑和新增  
3. 服务管理  
    获取服务的日志  

### 已经实现的功能点：
0. 机器管理  
    机器状态查看  
1. 镜像管理  
    镜像发现  
    镜像信息编辑  
2. 容器部署  
    容器状态检查和容器日志查看  
    容器创建、启动、停止、重启、信息编辑和删除  
    容器的筛选  
    容器服务查看，可以跳转到服务部署页面  
3. 项目版本管理  
    版本的创建编辑删除  
    版本的上传和下载  
4. 服务的部署  
    服务的创建——支持版本库创建和临时上传文件创建  
    服务的编辑和删除和过滤查询  
    服务页面跳转到容器页面  

